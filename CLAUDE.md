# CLAUDE.md

Instructions for Claude Code when working with this repository.

## Overview

Modular dotfiles repository (v5.0.0) with unified `ctdev` CLI. Cross-platform support for macOS, Ubuntu, Debian, Fedora, and Arch.

## ctdev CLI

```bash
ctdev install [component...]    # Install components (all if none specified)
ctdev update [component...]     # Update components
ctdev doctor                    # Check installation health
ctdev list                      # List available components
ctdev info                      # Show system information
ctdev uninstall <component...>  # Remove components
ctdev setup                     # Symlink ctdev to ~/.local/bin
```

**Flags:** `--help`, `--verbose`, `--dry-run`, `--version`

## Components

| Component | Description |
|-----------|-------------|
| apps | Desktop applications (Chrome, VSCode, Slack, etc.) |
| cli | CLI tools (jq, gh, kubectl, btop, etc.) |
| fonts | Nerd Fonts |
| git | Git configuration |
| node | Node.js via nodenv |
| ruby | Ruby via rbenv |
| zsh | Zsh, Oh My Zsh, Pure prompt, plugins |

## Directory Structure

```
dotfiles/
├── ctdev                 # CLI entry point (resolves symlinks)
├── lib/
│   ├── utils.sh         # Shared utilities (logging, platform detection)
│   ├── cli.sh           # CLI parsing and help text
│   └── components.sh    # Component registry
├── cmds/
│   ├── install.sh       # Install command
│   ├── update.sh        # Update command
│   ├── doctor.sh        # Doctor command
│   ├── list.sh          # List command
│   ├── info.sh          # Info command
│   ├── uninstall.sh     # Uninstall command
│   └── setup.sh         # Setup command
├── components/
│   ├── apps/            # Desktop apps (individual .sh per app)
│   ├── cli/             # CLI tools (individual .sh per tool)
│   ├── fonts/           # Nerd Fonts
│   ├── git/             # Git config
│   ├── node/            # Node.js
│   ├── ruby/            # Ruby
│   └── zsh/             # Zsh config
├── shell/               # Shell config (symlinked to ~/.oh-my-zsh/custom/)
└── VERSION
```

## Key Utilities (lib/utils.sh)

**Logging:** `log_info`, `log_success`, `log_warning`, `log_error`, `log_step`, `log_debug`

**Platform:** `detect_os`, `detect_arch`, `get_package_manager`, `is_macos`, `is_linux`, `maybe_sudo`

**Files:** `safe_symlink`, `backup_file`, `run_cmd` (respects DRY_RUN)

**Packages:** `install_package`, `install_brew_cask`, `ensure_git_repo`

## Git Commits

- Use single-line commit messages
- No "Co-Authored-By" or "Generated by" footers

## Conventions

- All scripts use `#!/usr/bin/env bash` and `set -euo pipefail`
- Scripts are idempotent (safe to re-run)
- Use `maybe_sudo` instead of `sudo` for Docker compatibility
- Use `run_cmd` to respect DRY_RUN flag
- macOS uses Homebrew; Linux uses apt/dnf/pacman
- Symlink configs instead of copying

## Adding Components

1. Create script in `components/<name>/install.sh`
2. Source `lib/utils.sh` for utilities
3. Use `log_*` functions for output
4. Respect `DRY_RUN` via `run_cmd`
5. Add to `COMPONENTS` array in `lib/components.sh`

## Adding CLI Tools

Create `components/cli/<tool>.sh`:
```bash
#!/usr/bin/env bash
set -euo pipefail
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
source "$SCRIPT_DIR/../../lib/utils.sh"

if command -v <tool> >/dev/null 2>&1; then
  log_info "<tool> already installed"
  exit 0
fi

OS=$(detect_os)
if [[ "$OS" == "macos" ]]; then
  brew install <tool>
else
  install_package <tool>
fi
```

Then add to `components/cli/install.sh`.
